import{j as he,k as z,l as Ce,w as U}from"./singletons.00f95ab0.js";import{p as te}from"./stores.51e838d1.js";import{Y as S,F as Ae,t as Fe}from"./scheduler.fab10f6a.js";import{U as ke,N as Re,P as Le,a as $e,b as Te,H as De,p as Ne}from"./parse.7d180a0f.js";const Ue=!0;class le extends Error{constructor(t,i){super(t),this.name="DevalueError",this.path=i.join("")}}function Ee(e){return Object(e)!==e}const Ve=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function He(e){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null||Object.getOwnPropertyNames(t).sort().join("\0")===Ve}function Ze(e){return Object.prototype.toString.call(e).slice(8,-1)}function Be(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function X(e){let t="",i=0;const o=e.length;for(let a=0;a<o;a+=1){const s=e[a],r=Be(s);r&&(t+=e.slice(i,a)+r,i=a+1)}return`"${i===0?e:t+e.slice(i)}"`}function Pe(e,t){const i=[],o=new Map,a=[];for(const c in t)a.push({key:c,fn:t[c]});const s=[];let r=0;function u(c){if(typeof c=="function")throw new le("Cannot stringify a function",s);if(o.has(c))return o.get(c);if(c===void 0)return ke;if(Number.isNaN(c))return Re;if(c===1/0)return Le;if(c===-1/0)return $e;if(c===0&&1/c<0)return Te;const A=r++;o.set(c,A);for(const{key:l,fn:h}of a){const E=h(c);if(E)return i[A]=`["${l}",${u(E)}]`,A}let d="";if(Ee(c))d=de(c);else switch(Ze(c)){case"Number":case"String":case"Boolean":d=`["Object",${de(c)}]`;break;case"BigInt":d=`["BigInt",${c}]`;break;case"Date":d=`["Date","${c.toISOString()}"]`;break;case"RegExp":const{source:h,flags:E}=c;d=E?`["RegExp",${X(h)},"${E}"]`:`["RegExp",${X(h)}]`;break;case"Array":d="[";for(let v=0;v<c.length;v+=1)v>0&&(d+=","),v in c?(s.push(`[${v}]`),d+=u(c[v]),s.pop()):d+=De;d+="]";break;case"Set":d='["Set"';for(const v of c)d+=`,${u(v)}`;d+="]";break;case"Map":d='["Map"';for(const[v,M]of c)s.push(`.get(${Ee(v)?de(v):"..."})`),d+=`,${u(v)},${u(M)}`;d+="]";break;default:if(!He(c))throw new le("Cannot stringify arbitrary non-POJOs",s);if(Object.getOwnPropertySymbols(c).length>0)throw new le("Cannot stringify POJOs with symbolic keys",s);if(Object.getPrototypeOf(c)===null){d='["null"';for(const v in c)s.push(`.${v}`),d+=`,${X(v)},${u(c[v])}`,s.pop();d+="]"}else{d="{";let v=!1;for(const M in c)v&&(d+=","),v=!0,s.push(`.${M}`),d+=`${X(M)}:${u(c[M])}`,s.pop();d+="}"}}return i[A]=d,A}const m=u(e);return m<0?`${m}`:`[${i.join(",")}]`}function de(e){const t=typeof e;return t==="string"?X(e):e instanceof String?X(e.toString()):e===void 0?ke.toString():e===0&&1/e<0?Te.toString():t==="bigint"?`["BigInt","${e}"]`:String(e)}const Me=Ue,je=he("invalidate_all"),qe=he("before_navigate"),We=he("after_navigate");function be(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function Ye(e){return e.reduce((t,i)=>(typeof i=="number"||!isNaN(parseInt(String(i),10))?t+=`[${String(i)}]`:t?t+=`.${String(i)}`:t+=String(i),t),"")}class C extends Error{constructor(t){super(t),Object.setPrototypeOf(this,C.prototype)}}function oe(e,t,i){return e[t]=i,"skip"}function ve(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function Je(e,t,i={}){i.modifier||(i.modifier=a=>ve(t,a)?void 0:a.value);const o=R(e,t,i.modifier);if(o)return i.value===void 0||i.value(o.value)?o:void 0}function R(e,t,i){if(!t.length)return;const o=[t[0]];let a=e;for(;o.length<t.length;){const r=o[o.length-1],u=i?i({parent:a,key:String(r),value:a[r],path:o.map(m=>String(m)),isLeaf:!1,set:m=>oe(a,r,m)}):a[r];if(u===void 0)return;a=u,o.push(t[o.length])}const s=t[t.length-1];return{parent:a,key:String(s),value:a[s],path:t.map(r=>String(r)),isLeaf:!0,set:r=>oe(a,s,r)}}function V(e,t,i=[]){for(const o in e){const a=e[o],s=a===null||typeof a!="object",r={parent:e,key:o,value:a,path:i.map(String).concat([o]),isLeaf:s,set:m=>oe(e,o,m)},u=t(r);if(u==="abort")return u;if(u==="skip")continue;if(!s){const m=V(a,t,r.path);if(m==="abort")return m}}}async function Ge(e,t,i=[]){for(const o in e){const a=e[o],s=a===null||typeof a!="object",r={parent:e,key:o,value:a,path:i.map(String).concat([o]),isLeaf:s,set:m=>oe(e,o,m)},u=await t(r);if(u==="abort")return u;if(u==="skip")break;if(!s){const m=V(a,t,r.path);if(m==="abort")return m}}}function Ke(e,t){return e===t||e.size===t.size&&[...e].every(i=>t.has(i))}function Xe(e,t){const i=new Map;function o(a,s){const r=R(s,a.path);function u(){i.set(a.path.join(" "),a.path)}a.isLeaf?r?(a.value instanceof Date&&r.value instanceof Date&&a.value.getTime()!=r.value.getTime()||a.value!==r.value)&&u():u():r&&a.value instanceof Set&&r.value instanceof Set&&!Ke(a.value,r.value)&&u()}return V(e,a=>o(a,t)),V(t,a=>o(a,e)),Array.from(i.values())}function G(e,t,i){for(const o of t){const a=R(e,o,({parent:s,key:r,value:u})=>((u===void 0||typeof u!="object")&&(s[r]={}),s[r]));a&&(a.parent[a.key]=i)}}function me(e,t){const i=be(t),o=z(e,a=>{const s=R(a,i);return s==null?void 0:s.value});return{subscribe(...a){const s=o.subscribe(...a);return()=>{s()}},update(a){e.update(s=>{const r=R(s,i);return r&&(r.parent[r.key]=a(r.value)),s})},set(a){e.update(s=>{const r=R(s,i);return r&&(r.parent[r.key]=a),s})}}}function J(e){return"structuredClone"in globalThis?structuredClone(e):Ne(Pe(e))}function Qe(e){const t=e;let i=!0,o=!1,a=!1,s=!1,r,u;for(;i;)e._def.typeName=="ZodNullable"?(o=!0,e=e.unwrap()):e._def.typeName=="ZodDefault"?(s=!0,u=e._def.defaultValue(),e=e._def.innerType):e._def.typeName=="ZodOptional"?(a=!0,e=e.unwrap()):e._def.typeName=="ZodEffects"?(r||(r=e),e=e._def.schema):e._def.typeName=="ZodPipeline"?e=e._def.out:i=!1;return{zodType:e,originalType:t,isNullable:o,isOptional:a,hasDefault:s,defaultValue:u,effects:r}}const ye=new WeakMap;function ge(e){return ye.has(e)||ye.set(e,ee(e)),ye.get(e)}function ee(e){const t=Qe(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([i,o])=>[i,ee(o)]).filter(i=>i[1]!==void 0));if(t._def.typeName=="ZodArray")return ee(t._def.type)??{};if(t._def.typeName=="ZodRecord")return ee(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((o,a)=>{const s=ee(a);return s&&(o={...o??{},...s}),o},void 0)}function ue(e,t,i=!0){const o={},a=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!i)return e._errors;o._errors=e._errors}for(const[s,r]of a.filter(([u])=>u!=="_errors")){const u=!isNaN(parseInt(s,10));o[s]=ue(r,t?u?t:t[s]:void 0,!!(t!=null&&t[s]))}return o}function ze(e){return Oe(e,[])}function Oe(e,t){return Object.entries(e).filter(([,o])=>o!==void 0).flatMap(([o,a])=>{if(Array.isArray(a)&&a.length>0){const s=t.concat([o]);return{path:Ye(s),messages:a}}else return Oe(e[o],t.concat([o]))})}function Ie(e,t){e.update(i=>(V(i,o=>{if(!(o.path.length==1&&o.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(o.value))return o.set(void 0)}),t.undefinePath&&G(i,[t.undefinePath],void 0),i))}async function xe(e,t,i,o,a){return et(e.validators,t,i,o,a)}async function et(e,t,i,o,a){if(e){let s,r={};if("safeParseAsync"in e){const u=e,m=await u.safeParseAsync(t);s=m.success,m.success||(r=ue(m.error.format(),ge(u)))}else{s=!0;const u=e,m=[];await Ge(t,async({value:c,path:A})=>{const d=A.filter(h=>isNaN(parseInt(h))),l=R(u,d);if(typeof(l==null?void 0:l.value)=="function"){const h=l.value;if(Array.isArray(c))for(const E in c){const v=await h(c[E]);v&&(s=!1,m.push({path:A.concat([E]),errors:typeof v=="string"?[v]:v??void 0}))}else{const E=await h(c);E&&(s=!1,m.push({path:A,errors:typeof E=="string"?[E]:E??void 0}))}}});for(const{path:c,errors:A}of m){const d=R(r,c,({parent:l,key:h,value:E})=>(E===void 0&&(l[h]={}),l[h]));if(d){const{parent:l,key:h}=d;l[h]=A}}}if(!s)return{valid:!1,posted:a,errors:r,data:t,constraints:o,message:void 0,id:i}}return{valid:!0,posted:a,errors:{},data:t,constraints:o,message:void 0,id:i}}async function tt(e,t,i){if(typeof e.validators!="object"||!("safeParseAsync"in e.validators))return;const o=e.validators,a=await o.safeParseAsync(t);if(a.success)i.update(s=>(V(s,r=>{if(r.key=="_errors")return r.set(void 0)}),s));else{const s=ue(a.error.format(),ge(o));i.update(r=>(V(r,u=>{if(u.key=="_errors")return u.set(void 0)}),V(s,u=>{if(u.key=="_errors")return G(r,[u.path],u.value)}),r))}}async function pe(e,t,i,o,a,s={}){function r(){Ie(o,{undefinePath:e,clearFormLevelErrors:!0})}function u(c){return typeof c=="string"&&(c=[c]),(s.update===!0||s.update=="errors")&&o.update(A=>{const d=R(A,e,l=>{if(ve(e,l))throw new C("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+l.path.slice(0,-1));return l.value===void 0?(l.parent[l.key]={},l.parent[l.key]):l.value});if(!d)throw new C("Error path could not be created: "+e);return d.parent[d.key]=c??void 0,A}),c??void 0}const m=await rt(e,t.validators,i,o,a,s);if(m.validated)if(m.validated==="all"&&!m.errors)r();else return u(m.errors);else if(m.validated===!1&&t.defaultValidator=="clear")return u(void 0);return m.errors}async function rt(e,t,i,o,a,s={}){s.update===void 0&&(s.update=!0),s.taint===void 0&&(s.taint=!1),typeof s.errors=="string"&&(s.errors=[s.errors]);const r={value:s.value,shouldUpdate:!0,currentData:void 0,validationPath:e.filter(l=>isNaN(parseInt(l)))};async function u(){return{validated:!1,errors:void 0}}function m(l,h){if(h===void 0)return!1;const E=R(h,l);return E?E.value===!0:!1}function c(l){o.update(l)}function A(){o.update(l=>(V(l,h=>{if(h.key=="_errors")return h.set(void 0)}),l))}function d(l,h){return ue(l.format(),ge(h))}if("value"in s)s.update===!0||s.update==="value"?i.update(l=>(G(l,[e],r.value),r.currentData=l),{taint:s.taint}):r.shouldUpdate=!1;else{r.currentData=S(i);const l=R(r.currentData,e);r.value=l==null?void 0:l.value}if(typeof t!="object")return u();if("safeParseAsync"in t){r.shouldUpdate||(r.currentData=J(r.currentData??S(i)),G(r.currentData,[e],r.value));const l=await t.safeParseAsync(r.currentData);if(l.success)return A(),{validated:!0,errors:void 0};{const h=d(l.error,t);if(s.update===!0||s.update=="errors"){const v=S(a);c(M=>(V(M,N=>{if(N.key=="_errors")return N.set(void 0)}),V(h,N=>{if(N.key=="_errors")return G(M,[N.path],N.value);if(Array.isArray(N.value))return m(N.path,v)&&G(M,[N.path],N.value),"skip"}),M))}const E=R(h,e);return{validated:!0,errors:s.errors??(E==null?void 0:E.value)}}}else{const l=R(t,r.validationPath);if(l){if(l.value===void 0)return u();{const h=await l.value(r.value);return{validated:!0,errors:h&&(s.errors??h)}}}else throw new C("No Superforms validator found: "+e)}}function ie(e){return Ce.apply_action(e)}function nt(e){const t=JSON.parse(e);return t.data&&(t.data=Ne(t.data)),t}function _e(e){return HTMLElement.prototype.cloneNode.call(e)}function at(e,t=()=>{}){const i=async({action:a,result:s,reset:r})=>{s.type==="success"&&(r!==!1&&HTMLFormElement.prototype.reset.call(e),await je()),(location.origin+location.pathname===a.origin+a.pathname||s.type==="redirect"||s.type==="error")&&ie(s)};async function o(a){var E,v,M,N;if(((E=a.submitter)!=null&&E.hasAttribute("formmethod")?a.submitter.formMethod:_e(e).method)!=="post")return;a.preventDefault();const r=new URL((v=a.submitter)!=null&&v.hasAttribute("formaction")?a.submitter.formAction:_e(e).action),u=new FormData(e),m=(M=a.submitter)==null?void 0:M.getAttribute("name");m&&u.append(m,((N=a.submitter)==null?void 0:N.getAttribute("value"))??"");const c=new AbortController;let A=!1;const l=await t({action:r,cancel:()=>A=!0,controller:c,get data(){return u},formData:u,get form(){return e},formElement:e,submitter:a.submitter})??i;if(A)return;let h;try{const T=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:u,signal:c.signal});h=nt(await T.text()),h.type==="error"&&(h.status=T.status)}catch(T){if((T==null?void 0:T.name)==="AbortError")return;h={type:"error",error:T}}l({action:r,get data(){return u},formData:u,get form(){return e},formElement:e,update:T=>i({action:r,result:h,reset:T==null?void 0:T.reset}),result:h})}return HTMLFormElement.prototype.addEventListener.call(e,"submit",o),{destroy(){HTMLFormElement.prototype.removeEventListener.call(e,"submit",o)}}}const st=(e,t=0)=>{const i=e.getBoundingClientRect();return i.top>=t&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)},it=(e,t=1.125,i="smooth")=>{const s=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:s,behavior:i})};var O;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(O||(O={}));function Se(e){!e.flashMessage||!Me||we(e)&&(document.cookie=`flash=; Max-Age=0; Path=${e.flashMessage.cookiePath??"/"};`)}function we(e){return!e.flashMessage||!Me?!1:e.syncFlashMessage}function ot(e,t,i,o,a,s,r,u,m,c,A,d,l,h,E,v,M){c();const N=a;async function T(y){await pe(y,r,u,N,h)}function re(y){return y&&(y instanceof HTMLSelectElement||y instanceof HTMLInputElement&&y.type=="radio")}async function Q(y){if(!(r.validationMethod=="oninput"||r.validationMethod=="submit-only")){re(y.target)&&await new Promise(j=>setTimeout(j,0));for(const j of S(E))T(j);E.set([])}}e.addEventListener("focusout",Q);const Z=new Set;function ne(y){const j=y.target;r.selectErrorText&&j.select()}function ae(y){y.querySelectorAll("input").forEach(j=>{j.addEventListener("invalid",ne)})}function B(y){y.querySelectorAll("input").forEach(j=>j.removeEventListener("invalid",ne))}We(y=>{y.type=="goto"&&L.completed(!0)}),Ae(()=>{Z.forEach(y=>B(y)),Z.clear(),e.removeEventListener("focusout",Q),L.completed(!0)});function Y(y){function j(){if(r.selectErrorText){const F=q();F&&y!==F&&(B(F),Z.delete(F)),Z.has(y)||(ae(y),Z.add(y))}H=y}let H;function q(){return H}function K(F){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(F)}const W=async()=>{if(r.scrollToError=="off")return;const F=r.errorSelector;if(!F)return;await Fe();let _;if(_=H.querySelector(F),!_)return;_=_.querySelector(F)??_;const b=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;if(typeof r.scrollToError!="string"?_.scrollIntoView(r.scrollToError):st(_,(b==null?void 0:b.offsetHeight)??0)||it(_,void 0,r.scrollToError),!K(navigator.userAgent))return;let w;if(w=_,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(w.tagName)||(w=w.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),w)try{w.focus({preventScroll:!0}),r.selectErrorText&&w.tagName=="INPUT"&&w.select()}catch{}};j();{let F=O.Idle,_,b;const w=P=>{F=P,t.set(F>=O.Submitting),i.set(F>=O.Delayed),o.set(F>=O.Timeout)};return{submitting:()=>{j(),w(F!=O.Delayed?O.Submitting:O.Delayed),_&&clearTimeout(_),b&&clearTimeout(b),_=window.setTimeout(()=>{F==O.Submitting&&w(O.Delayed)},r.delayMs),b=window.setTimeout(()=>{F==O.Delayed&&w(O.Timeout)},r.timeoutMs)},completed:P=>{_&&clearTimeout(_),b&&clearTimeout(b),_=b=0,w(O.Idle),P||setTimeout(W)},scrollToFirstError:()=>setTimeout(W),isSubmitting:()=>F===O.Submitting||F===O.Delayed}}}const L=Y(e);let I;return at(e,async y=>{var F;const j=y.cancel;let H=!1;function q(){return H=!0,j()}if(y.cancel=q,L.isSubmitting()&&r.multipleSubmits=="prevent")q();else{L.isSubmitting()&&r.multipleSubmits=="abort"&&I&&I.abort(),I=y.controller;for(const _ of A.onSubmit)await _(y)}if(H)r.flashMessage&&Se(r);else{const _=await xe(r,S(u),S(d),S(l),S(M));if(!_.valid){q();const b={type:"failure",status:(typeof r.SPA=="boolean"||(F=r.SPA)==null?void 0:F.failStatus)??400,data:{form:_}};setTimeout(()=>W({result:b}),0)}if(!H){switch(r.clearOnSubmit){case"errors-and-message":N.clear(),m.set(void 0);break;case"errors":N.clear();break;case"message":m.set(void 0);break}r.flashMessage&&(r.clearOnSubmit=="errors-and-message"||r.clearOnSubmit=="message")&&we(r)&&r.flashMessage.module.getFlash(te).set(void 0),L.submitting();const b="formData"in y?y.formData:y.data;if(r.SPA){q();const P={type:"success",status:200,data:{form:{valid:!0,posted:!0,errors:{},data:S(u),constraints:S(l),message:void 0,id:S(d)}}};setTimeout(()=>W({result:P}),0)}else if(r.dataType==="json"){const w=S(u),P=K(Pe(w),r.jsonChunkSize??5e5);for(const k of P)b.append("__superform_json",k);Object.keys(w).forEach(k=>{typeof b.get(k)=="string"&&b.delete(k)})}if(!r.SPA&&!b.has("__superform_id")){const w=S(d);w!==void 0&&b.set("__superform_id",w)}}}function K(_,b){const w=Math.ceil(_.length/b),P=new Array(w);for(let k=0,$=0;k<w;++k,$+=b)P[k]=_.substring($,$+b);return P}async function W(_){const b=_.result;I=null;let w=!1;const P={result:b,formEl:e,cancel:()=>w=!0};for(const k of A.onResult)await k(P);if(!w){if((b.type==="success"||b.type=="failure")&&b.data){const k=v(b.data);if(!k.length)throw new C("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const $ of k){if($.id!==S(d))continue;const fe={form:$,formEl:e,cancel:()=>w=!0};for(const se of A.onUpdate)await se(fe)}}if(!w){if(b.type!=="error")b.type==="success"&&r.invalidateAll&&await je(),r.applyAction?await ie(b):await s(b);else{if(r.applyAction)if(r.onError=="apply")await ie(b);else{const k={type:"failure",status:Math.floor(b.status||500),data:b};await ie(k)}if(r.onError!=="apply"){const k={result:b,message:m};for(const $ of A.onError)$!=="apply"&&await $(k)}}r.flashMessage&&b.type=="error"&&r.flashMessage.onError&&await r.flashMessage.onError({result:b,message:r.flashMessage.module.getFlash(te)})}}w&&r.flashMessage&&Se(r),(w||b.type!="redirect")&&L.completed(w)}return W})}new TextEncoder;const ut={applyAction:!0,invalidateAll:!0,resetForm:!1,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:"Do you want to leave this page? Changes you made may not be saved.",onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:e=>{console.warn("Unhandled Superform error, use onError event to handle it:",e.result.error)},dataType:"form",validators:void 0,defaultValidator:"keep",clearOnSubmit:"errors-and-message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",validation:void 0,SPA:void 0,validateMethod:"auto"};function mt(e,t={}){var se;t={...ut,...t},t.SPA&&t.validators===void 0&&console.warn("No validators set for Superform in SPA mode. Add them to the validators option, or set it to false to disable this warning.");let i=t.id;!e||l(e)===!1?(((se=t.warnings)==null?void 0:se.noValidationAndConstraints)!==!1&&console.warn((e?"Form data sent directly to superForm instead of through superValidate. No initial data validation is made. ":"No form data sent to superForm, schema type safety cannot be guaranteed. ")+"Also, no constraints will exist for the form. Set the warnings.noValidationAndConstraints option to false to disable this warning."),e={valid:!1,posted:!1,errors:{},data:e??{},constraints:{}}):i===void 0&&(i=e.id);const o=S(te).form;if(o&&typeof o=="object"){for(const n of d(o).reverse())if(n.id===i){const f=e;e=n,e.valid&&t.resetForm&&(t.resetForm===!0||t.resetForm())&&(e=J(f),e.message=n.message);break}}const a=e,s=J(a);if(typeof s.valid!="boolean")throw new C("A non-validation object was passed to superForm. Check what's passed to its first parameter.");const r=U(a.errors),u=U(i),m={taintedMessage:t.taintedMessage,taintedFormState:J(s.data)};function c(n=8){return Math.random().toString(36).substring(2,n+2)}function A(n){m.taintedFormState=J(n)}function d(n){var p;const f=Object.values(n).filter(g=>l(g)!==!1);if(f.length>1&&((p=t.warnings)==null?void 0:p.duplicateId)!==!1){const g=new Set;for(const x of f)g.has(x.id)?console.warn(`Duplicate form id found: "${x.id}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set warnings.duplicateId option to false to disable this message.`):g.add(x.id)}return f}function l(n){return!n||typeof n!="object"||!("valid"in n&&"errors"in n&&typeof n.valid=="boolean")?!1:"id"in n&&typeof n.id=="string"?n.id:void 0}function h(){t.taintedMessage=m.taintedMessage,i===void 0&&u.set(c())}function E(n){const f=U(n);return{subscribe:f.subscribe,set:(p,g={})=>(K(p,m.taintedFormState,g.taint??!0),A(p),f.set(J(p))),update:(p,g={})=>f.update(x=>{const D=p(x);return K(D,m.taintedFormState,g.taint??!0),A(D),D})}}const v=[u.subscribe(n=>i=n)];function M(n){v.push(n)}function N(){v.forEach(n=>n())}const T=E(a.data);function re(n,f){if(!(!f||typeof f!="object")){if(Array.isArray(f))f.length>0&&re(n,f[0]);else if(!(f instanceof Date))throw new C(`Object found in form field "${n}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}}async function Q(n,f){n.valid&&f&&t.resetForm&&(t.resetForm===!0||t.resetForm())?Z(n.message):P(n,f),k.onUpdated.length&&await Fe();for(const p of k.onUpdated)p({form:n})}function Z(n,f,p){const g=J(s);g.data={...g.data,...f},p!==void 0&&(g.id=p),P(g,!0,n)}const ne=async(n,f)=>{if(n.type=="error")throw new C(`ActionResult of type "${n.type}" cannot be passed to update function.`);if(n.type=="redirect"){t.resetForm&&(t.resetForm===!0||t.resetForm())&&Z();return}if(typeof n.data!="object")throw new C("Non-object validation data returned from ActionResult.");const p=d(n.data);if(!p.length)throw new C("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const g of p)g.id===i&&await Q(g,f??(n.status>=200&&n.status<300))},ae=U([]),B=U(a.message),Y=U(a.constraints),L=U(!1),I={subscribe:r.subscribe,set:r.set,update:r.update,clear:()=>Ie(r,{undefinePath:null,clearFormLevelErrors:!0})},y=U();function j(){return S(y)}function H(n){if(n===null)throw new C("$tainted store contained null");if(typeof n=="object"){for(const f of Object.values(n))if(H(f))return!0}return n===!0}async function q(n,f){if(t.validationMethod=="onblur"||t.validationMethod=="submit-only")return!1;let p=t.validationMethod==="oninput";if(!p){const g=S(I),x=g?Je(g,n,{modifier:ce=>{if(ve(n,ce))throw new C("Errors can only be added to form fields, not to arrays or objects in the schema. Path: "+ce.path.slice(0,-1));return ce.value}}):void 0;p=!!(x&&x.key in x.parent)}return p?(await pe(n,t,T,I,y,{taint:f}),!0):!1}async function K(n,f,p){if(p===!1)return;if(p==="untaint-all"){y.set(void 0);return}let g=Xe(n,f);if(typeof p=="object"&&(typeof p.fields=="string"&&(p.fields=[p.fields]),g=p.fields.map(x=>be(x)),p=!0),p===!0&&ae.set(g),g.length){y.update(D=>(D||(D={}),G(D,g,p===!0?!0:void 0),D));let x=!1;for(const D of g)x=x||await q(D,p);x||await tt(t,S(T),I)}}function W(n,f){y.set(n),A(f)}const F=U(!1),_=U(!1),b=U(!1),w=z(I,n=>n?ze(n):[]);if(t.taintedMessage=void 0,Ae(()=>{N();for(const n of Object.values(k))n.length=0}),t.dataType!=="json")for(const[n,f]of Object.entries(a.data))re(n,f);function P(n,f,p){if(f&&W(typeof f=="boolean"?void 0:f,n.data),p=p??n.message,T.set(n.data,{taint:!1}),B.set(p),I.set(n.errors),u.set(n.id),L.set(n.posted),t.flashMessage&&we(t)){const g=t.flashMessage.module.getFlash(te);p&&S(g)===void 0&&g.set(p)}}const k={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};qe(n=>{if(t.taintedMessage&&!S(F)){const f=j();f&&H(f)&&!window.confirm(t.taintedMessage)&&n.cancel()}}),M(te.subscribe(async n=>{if(!t.applyAction)return;const f=n.status>=200&&n.status<300;if(n.form&&typeof n.form=="object"){if(n.form.type=="error")return;const p=d(n.form);for(const g of p)g.id===i&&await Q(g,f)}else if(n.data&&typeof n.data=="object"){const p=d(n.data);for(const g of p)g.id===i&&P(g,f)}}));const $=Object.fromEntries(Object.keys(s.data).map(n=>[n,{name:n,value:me(T,n),errors:me(I,n),constraints:me(Y,n)}]));function fe(n,f){return n===void 0?xe(t,S(T),i,S(Y),!1):pe(be(n),t,T,I,y,f)}return{form:T,formId:u,errors:I,message:B,constraints:Y,fields:$,tainted:y,submitting:z(F,n=>n),delayed:z(_,n=>n),timeout:z(b,n=>n),options:t,capture:function(){return{valid:s.valid,posted:S(L),errors:S(I),data:S(T),constraints:S(Y),message:S(B),id:i,tainted:S(y)}},restore:function(n){return P(n,n.tainted??!0)},validate:fe,enhance:(n,f)=>{if(f){if(f.onError){if(t.onError==="apply")throw new C('options.onError is set to "apply", cannot add any onError events.');if(f.onError==="apply")throw new C('Cannot add "apply" as onError event in use:enhance.');k.onError.push(f.onError)}f.onResult&&k.onResult.push(f.onResult),f.onSubmit&&k.onSubmit.push(f.onSubmit),f.onUpdate&&k.onUpdate.push(f.onUpdate),f.onUpdated&&k.onUpdated.push(f.onUpdated)}return ot(n,F,_,b,I,ne,t,T,B,h,k,u,Y,y,ae,d,L)},allErrors:w,posted:L,reset:n=>Z(n!=null&&n.keepMessage?S(B):void 0,n==null?void 0:n.data,n==null?void 0:n.id)}}export{mt as s};
